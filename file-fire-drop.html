<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="file-fire-behavior.html">

<dom-module id="file-fire-drop">
    <template>
        <style>
            :host {
              display: block;
              height: 100%;
              width: 100%;
              position:relative;
            }
            #dropZone {
              display:var(--file-fire-display, none);
              height: 100%;
              width: 100%;
              position:absolute;
              top:0px;
              left:0px;
              background: var(--file-fire-dropzone-background,#e9f0fa);
            }

            #filez{
              display:block;
              height: 100%;
              width: 100%;
              position: absolute;
              top:0px;
              left:0px;
              opacity:0;
              z-index:200;
              background:black;
            }
            #border{
              color: var(--file-fire-color,#b1bfd4);
              width:calc(100% - 46px);
              height:calc(50% - 46px);
              border: var(--file-fire-border,3px dashed #b1bfd4);
              margin:20px;
              padding-top:50%;
              text-align: center;
              size: 18px;
            }

        </style>

<div id ="dropZone">
  <div id="border">
    <p>{{hoverText}}</p>
  </div>
  
  <template is="dom-if" if={{onlyImages}}>
    <input type="file" id="filez" accept="image/*" on-change="_loadImage" on-drag-enter="_enter" on-drop="_drop">
  </template>

  <template is="dom-if" if={{!onlyImages}}>
    <input type="file" id="filez" on-change="_loadImage" on-drag-enter="_enter" on-drop="_drop">
  </template>
</div>
<content></content>

        
    </template>

  <script>
    /**
     * An element that allows simple upload of an image to Firebase storage
     * Example:
     * ```
     * <firebase-app
     *   name="demo"
     *   api-key="API_KEY"
     *   auth-domain="AUTH_DOMAIN"
     *   database-url="DATABASE_URL"
     *   storage-bucket="convoofire.appspot.com">
     * </firebase-app>
     * <!-- A file-fire-drop element allowing image upload to firebase storage -->
     *  <file-fire-drop 
     *       storage-path="/u/test"
     *       src-url="https://pbs.twimg.com/profile_images/741290730170122240/abfazODg_400x400.jpg"
     *       over-write
     *       max-size="500"
     *       progress="{{progress}}"
     *       base64="{{base64}}"
     *   ></file-fire-drop>
     * ```
     *
     *
     * @demo demo/file-fire-drop.html
     */
    Polymer({
      is: 'file-fire-drop',
      behaviors: [FileFireBehavior],
      properties: {
        /**
        * `hoverText` the text that displays when a user hovers over the section with a file
        */
        hoverText: {
          type: String,
          value: "Upload a file."
        },
        /**
        * `alwaysShow` shows the drop file section by default. This means content inside the element will not be shown.
        */
        alwaysShow: {
          type: Boolean,
          value: false,
          observer: "_checkShow"
        }
      },
    
    listeners: {
        'dragenter' : '_enter',
        'dropZone.dragenter' : '_enter',
        'dropZone.dragleave' : '_exit'
    },

    _checkShow: function(newShow, oldShow){
      if(newShow){
        this.customStyle["--file-fire-display"] = "block";
        this.updateStyles();
      }
    },


    _hasAFile: function(e){
      if (e.dataTransfer.types) {
        for (var i=0; i<e.dataTransfer.types.length; i++) {
          if (e.dataTransfer.types[i] == "Files") {
            return true;
          }
        }
      }
      return false
    },

    _enter: function(e){
      if(this._hasAFile(e) && !this.alwaysShow){
        e.stopPropagation();
        e.preventDefault();
        this.customStyle["--file-fire-display"] = "block";
        this.updateStyles();
      }
    },

    _exit: function(){
      if(!this.alwaysShow){
        this.customStyle["--file-fire-display"] = "none";
        this.updateStyles();
        console.log('exit');
      }
    },

    _drop: function(e){
        if(!this.alwaysShow){
        this.customStyle["--file-fire-display"] = "none";
        this.updateStyles();
        console.log('drop');
      }
    }

  });
  </script>
</dom-module>
